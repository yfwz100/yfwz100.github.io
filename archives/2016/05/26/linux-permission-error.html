<!DOCTYPE html><html><head><meta charset="utf-8"><title>æ¤çš„åšå®¢</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/base.css">
<script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$', '$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});</script><script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=default"></script><script type="text/javascript">(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ad6863b0ceb3ebc04afed41dc020bd78";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="æ¤çš„åšå®¢" type="application/atom+xml">
</head><body><header><div class="page"><nav><ul class="brand"><li><a href="/">æ¤çš„åšå®¢</a></li></ul><ul class="blog"><!-- List other items on menu.--><li class="menu-item"><a class="on" href="/archives">å­˜æ¡£</a></li><li class="menu-item"><a href="/tags">æ ‡ç­¾</a></li><li class="menu-item"><a href="https://sanduck.github.io/about/" target="_blank" rel="noopener">æ¢¦</a></li></ul><ul class="social"><li><a class="fa fa-${name}" href="https://github.com/yfwz100" target="_blank" rel="noopener"><i class="sr-only">github</i></a></li><li><a class="fa fa-${name}" href="http://git.oschina.net/zhi" target="_blank" rel="noopener"><i class="sr-only">git</i></a></li><li><a class="fa fa-${name}" href="http://weibo.com/yfwz100" target="_blank" rel="noopener"><i class="sr-only">weibo</i></a></li></ul></nav></div></header><div class="post wrap"><div class="page"><div class="post-heading"><h1>è®°ä¸€æ¬¡ Linux æƒé™æ•…éšœ</h1></div><div class="post-body"><p>æƒ³èµ·ä»Šå¤©çš„è¯¯æ“ä½œè¿˜çœŸçš„å¿ƒæœ‰ä½™æ‚¸ï¼Œå·®ç‚¹å°±è¦é‡æ–°å®‰è£…ç³»ç»Ÿäº†ã€‚ç¼˜èµ·æƒ³æ”¹å˜ <code>/data</code> è¿™ä¸ªç›®å½•çš„æ‰€æœ‰è€…ï¼Œç»“æœæ‰‹è¯¯è¿è¡Œäº† <code>sudo chown zhi:zhi /</code> ï¼Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„æƒé™éƒ½é‡ç½®ä¸ºå½“å‰ç”¨æˆ· zhi ï¼è¿™æ ·ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿçœ‹çœ‹è¿™ç¯‡è®¨è®ºï¼š <a href="http://askubuntu.com/questions/452860/usr-bin-sudo-must-be-owned-by-uid-0-and-have-the-setuid-bit-set" target="_blank" rel="noopener">AskUbuntu: sudo æƒé™é”™è¯¯</a> ï¼Œä¼šå¯¼è‡´ <code>sudo</code> å‘½ä»¤æ— æ³•æ‰§è¡Œã€ SSH æœåŠ¡å™¨åœæ­¢å“åº”ï¼Œæ— æ³•å®‰è£…è½¯ä»¶ï¼Œæ— æ³•è¿œç¨‹ç™»å½•ã€‚ç³Ÿç³•çš„æ˜¯ï¼Œè¿™å°æœåŠ¡å™¨è¿˜æ˜¯ä¸€å°è¿œç¨‹ä¸»æœºï¼Œæˆ‘æ— æ³•ç›´æ¥é‡è£…ç³»ç»Ÿæˆ–è€…è¿›å…¥â€œrecovery modeâ€ä¿®å¤ root æƒé™ã€‚æƒ³ç€ä»Šå¤©åšçš„åŸºç¡€è®¾æ–½å°±è¦æŠ¥åºŸäº†ï¼Œå¿ƒé‡ŒçœŸä¸æ˜¯æ»‹å‘³ã€‚</p>
<a id="more"></a>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆè¦ä»æ¢å¤æœ€é«˜ç®¡ç†å‘˜æƒé™å¼€å§‹ã€‚ç”±äºç°ä»£ Linux ç³»ç»Ÿï¼Œä¾‹å¦‚ Ubuntu ç³»ï¼Œéƒ½å·²ç»é‡‡ç”¨ <code>sudo</code> æ–¹æ¡ˆå¹¶è®¾ç½® root å¯†ç ä¸ºéšæœºå¯†ç ï¼Œç›´æ¥ su åˆ‡æ¢åˆ° root å¹¶ä¸ç°å®ã€‚è€Œç›´æ¥è¿è¡Œ <code>sudo</code> ï¼Œåˆ™ä¼šå‡ºç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo: &#x2F;usr&#x2F;bin&#x2F;sudo must be owned by uid 0</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªé”™è¯¯ï¼Œå¤šåŠæ˜¯ç”±äºæ‰‹è¯¯æŠŠ <code>/usr</code> ç›®å½•æˆ–è€…å­ç›®å½•çš„æƒé™æ”¹å˜å¯¼è‡´çš„äº†ã€‚</p>
<p>è§£å†³çš„æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠ <code>/usr/bin/sudo</code> è¿™ä¸ªå‘½ä»¤çš„æƒé™å¤åŸã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›å…¥ recovery modeï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥éšå¿ƒæ‰€æ¬²äº†ï¼Œè¯¦æƒ…å‚è§ <a href="http://askubuntu.com/questions/452860/usr-bin-sudo-must-be-owned-by-uid-0-and-have-the-setuid-bit-set" target="_blank" rel="noopener">AskUbuntu: sudo æƒé™é”™è¯¯</a> ã€‚ä½†æ˜¯å¦‚æœæ˜¯è¿œç¨‹ä¸»æœºï¼Œå°±æ²¡é‚£ä¹ˆå¥½åŠäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€äº›æ¼æ´ã€‚è€Œæˆ‘è¿™æ¬¡æ˜¯ä» <code>/data</code> è¿™ä¸ªå…±äº«çš„ NFS ç›®å½•å¼€å§‹çš„ï¼ˆå¹¸äº <strong>ä¹‹å‰æ­å»º NFS çš„æ—¶å€™æ²¡æœ‰è®¾ç½®æƒé™</strong> ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æŒ‚è½½äº†ï¼‰ã€‚</p>
<p>ç”±äº NFS å…±äº«ç›®å½•å¯ä»¥ä¿ç•™æƒé™ï¼Œä½¿ç”¨ <strong>å¦ä¸€å°æœºå™¨</strong> æŒ‚è½½è¿™ä¸ª NFS ç›®å½•ï¼Œå¹¶ä¸”æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp -a &#x2F;usr&#x2F;bin&#x2F;sudo &#x2F;data</span><br><span class="line">$ sudo cp -a &#x2F;usr&#x2F;lib&#x2F;sudo&#x2F;* &#x2F;data</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°ä¿ç•™æ‰€æœ‰æƒé™ä¿¡æ¯çš„ <code>sudo</code> å‘½ä»¤ä»¥åŠç›¸å…³çš„åº“æ–‡ä»¶ã€‚</p>
<p>ç„¶ååœ¨åŸæ¥çš„ä¸»æœºä¸Šï¼Œæ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ rm &#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">$ mv &#x2F;usr&#x2F;lib&#x2F;sudo &#x2F;usr&#x2F;local&#x2F;lib&#x2F;sudo.bak</span><br><span class="line">$ ln -s &#x2F;data &#x2F;usr&#x2F;lib&#x2F;sudo</span><br></pre></td></tr></table></figure>
<p>å…ˆåˆ é™¤ <code>/usr/bin/sudo</code> ï¼Œç„¶åæŠŠ <code>/usr/lib</code> ç›®å½•ç”¨ <code>/data</code> å–ä»£ã€‚ç”±äºè¿è¡Œ <code>sudo</code> å‘½ä»¤å®é™…ä¸Šä¼šè¿æ¥è°ƒç”¨ <code>/usr/lib/sudo</code> ç›®å½•ä¸‹çš„åº“ï¼Œå¹¶ä¸”ä¼šæ£€æŸ¥åº“æ–‡ä»¶çš„æƒé™ï¼Œä½†æ˜¯ä¸æ£€æŸ¥ <code>/usr/lib/sudo</code> ç›®å½•çš„å½¢å¼å’Œæƒé™ï¼Œæ„Ÿè§‰è¿™æ˜¯ä¸ªæ¼æ´ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œç°åœ¨æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ &#x2F;data&#x2F;sudo</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸäº†ï¼</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä¸€æ­¥æ­¥åœ°åˆ©ç”¨ <code>/data/sudo</code> å‘½ä»¤æ¢å¤ <code>/usr/bin/sudo</code> ä»¥åŠ <code>/usr/lib/sudo</code> äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ &#x2F;data&#x2F;sudo cp -a &#x2F;data&#x2F;sudo &#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">$ &#x2F;data&#x2F;sudo chown -R root:root &#x2F;usr&#x2F;lib&#x2F;sudo.bak</span><br><span class="line">$ &#x2F;data&#x2F;sudo cp -a &#x2F;usr&#x2F;lib&#x2F;sudo.bak &#x2F;usr&#x2F;lib&#x2F;sudo</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œ<code>sudo</code> å‘½ä»¤æ¢å¤å®Œæ¯•ã€‚æ¥ä¸‹æ¥å°±æ˜¯å¯¹ç…§ç€åŸæ¥çš„ Ubuntuï¼ŒæŠŠå…¶ä½™æƒé™é”™è¯¯çš„ç›®å½•æ¢å¤ä¸ºåŸæ¥çš„æƒé™äº†ã€‚å…¶ä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„æƒé™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown -R root:root &#x2F;var&#x2F;run&#x2F;ssh*</span><br></pre></td></tr></table></figure>
<p>æ¢å¤ SSH æœåŠ¡ï¼Œä½¿å¾—åœ¨æ–­çº¿åè¿˜å¯ä»¥é‡æ–°è¿æ¥ï¼ˆåˆ‡è®°ï¼Œå› ä¸ºç½‘ç»œçŠ¶æ€ä¸æ˜¯è°éƒ½å¯ä»¥é¢„æ–™çš„ ğŸ˜“ï¼‰ã€‚å…¶ä½™å‘½ä»¤ï¼Œå‚è€ƒ <a href="http://askubuntu.com/questions/265080/how-can-i-recover-from-chmod-r-a-wrx-command" target="_blank" rel="noopener">AskUbuntu: æ¢å¤ /* ç›®å½•æƒé™</a></p>
</div><div class="post-meta">ç”± <span class="author"><a href="mailto: yfwz100@yeah.net">Zhi</a></span> å†™äº <span class="date">2016å¹´5æœˆ26æ—¥</span> Â·<span class="tags"><a class="tag" href="/tags/Linux/">Linux</a></span></div><div class="cloud-tie-wrapper" id="cloud-tie-wrapper"></div><script type="text/javascript" src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script><script type="text/javascript">var cloudTieConfig = {
  url: document.location.href, 
  sourceId: "",
  productKey: "2311812cfc39469b8c071ba8f99d562e",
  target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);</script><script type="text/javascript" src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script></div></div><footer><div class="page"><address class="author">&copy; Zhi</address><div class="hexo-powered">åšå®¢ç”± <a href="http://www.hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨</div><div class="rss"><a class="fa fa-rss-square" href="/atom.xml"></a></div></div></footer></body></html>